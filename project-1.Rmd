---
title: "DATA 350: Project 1 - Exploratory Data Analysis Report"
author: "Group 11: Ademir Ferreyra, Jay Nadkarni, Adrien Rozario"
date: "10/17/2025"
output: html_document
---

```{r}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(NHANES)
library(forcats)
library(viridis)
```
## Introduction - Adrien

From 2009 to 2012, the U.S. National Center for Health (NCHS) conducted The National Health and Nutrition Examination Survey (NHANES) with the goal of assessing public health trends, lifestyles, and illness risk factors across the U.S. population. For our exploratory data analysis, we will use the NHANESraw dataset from the NHANES R package, which was collected from the unweighted original survey responses from 20,293 participants.

The purpose of this exploratory data analysis is to better understand how socioeconomic status, lifestyle choices, and demographic factors relate to overall health and well-being. Specifically, we aim to explore the following research questions:

* How does socioeconomic status (education, poverty, home ownership, income) relate to smoking, alcohol, and drug use?

* How do lifestyle choices (smoking, alcohol, and drug use) relate to self-rated health and sleep duration?

* How do demographic factors (age, marital status, gender) influence or interact with these lifestyle and health outcomes?

Key variables of interest include:

* HHIncomeMid – midpoint of household income category (numeric)

* Education – highest education level attained (categorical)

* HomeOwn – home ownership status (categorical)

* Poverty – family poverty income ratio (numeric)

* SmokeNow, Smoke100 – indicators of smoking behavior

* Alcohol12PlusYr, AlcoholDay, AlcoholYear – measures of alcohol use

* HardDrugs – indicator of recreational drug use (if available)

* HealthGen – self-rated general health (ordinal: Excellent–Poor)

* SleepHrsNight – average hours of sleep per night (numeric)

* Age, MaritalStatus, Gender – key demographic characteristics

We expect that higher socioeconomic status is associated with lower rates of smoking and drug use, moderate alcohol consumption, and better health outcomes.

<br>

## Data Cleaning - Adrien

Before conducting our exploratory analysis, we performed several data cleaning steps to ensure the quality and consistency of the NHANESraw dataset. These steps included handling missing values, converting variable types, addressing outliers, and stating key assumptions.

### Missing Value Handling

We began by examining the dataset for missing values using the summary() and colSums(is.na()) functions. Some demographic and lifestyle variables contained missing entries, especially those related to sensitive topics such as income and alcohol use.
For essential demographic variables such as Gender, Age, and Education, we removed rows with missing values. For numeric variables like HHIncomeMid and SleepHrsNight, we used median imputation if the proportion of missing data was low. Variables with a high proportion of missing variables (over 50%) were excluded from the analysis.

```{r}
# Load data
data("NHANESraw")

# Preview
head(NHANESraw)

# Examine missing values
colSums(is.na(NHANESraw))

# Remove rows with missing important demographic variables
nhanes_clean <- NHANESraw %>%
  filter(!is.na(Gender), !is.na(Age), !is.na(Education))

# Median imputation for numeric variables with low amount of missing values
nhanes_clean <- nhanes_clean %>%
  mutate(
    HHIncomeMid = ifelse(is.na(HHIncomeMid), median(HHIncomeMid, na.rm=TRUE), HHIncomeMid),
    SleepHrsNight = ifelse(is.na(SleepHrsNight), median(SleepHrsNight, na.rm=TRUE), SleepHrsNight)
  )
```

### Type Conversions

We then standardized variable types to ensure accurate analysis. Categorical variables such as SmokeNow, Gender, Education, and HomeOwn were converted to factors. Ordinal variables like HealthGen were stored as ordered factors to preserve their natural ranking. Numeric variables such as HHIncomeMid, Poverty, and SleepHrsNight were converted to numeric types.

```{r}
# Convert variables to appropriate types
nhanes_clean <- nhanes_clean %>%
  mutate(
    SmokeNow = as.factor(SmokeNow),
    Smoke100 = as.factor(Smoke100),
    Gender = as.factor(Gender),
    Education = as.factor(Education),
    HomeOwn = as.factor(HomeOwn),
    HealthGen = factor(HealthGen, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"), ordered = TRUE),
    HHIncomeMid = as.numeric(HHIncomeMid),
    Poverty = as.numeric(Poverty),
    SleepHrsNight = as.numeric(SleepHrsNight)
  )
```

### Outlier Removal and Transformations

To prevent extreme values from distorting results, we visualized the distributions of key numeric variables using histograms and boxplots. Implausible outliers were removed, such as participants reporting more than 16 hours of sleep or more than 20 alcoholic drinks per day. For skewed numeric variables such as income, we applied a log transformation to normalize the distribution.

```{r}
# Remove extreme outliers
nhanes_clean <- nhanes_clean %>%
  filter(SleepHrsNight <= 16, AlcoholDay <= 20)

# Log-transform skewed variables
nhanes_clean <- nhanes_clean %>%
  mutate(HHIncomeMid_log = log(HHIncomeMid + 1))
```

### Assumptions

During data cleaning, we made the following assumptions:
* Missing values are not related to unobserved variables.
* Median imputation provides a reasonable estimate of central tendency without introducing bias.
* Outliers identified represent data entry errors or unrealistic responses rather than meaningful population extremes.
* Ordinal variables (such as self-rated health) are consistently interpreted across respondents.
* These cleaning steps prepared the dataset for accurate and meaningful exploratory data analysis.

<br>

## Univariate Analysis

We began by exploring the distribution of individual variables to understand their distribution and potential outliers.

### Summary statistics

We calculated key descriptive statistics (mean, median, standard deviation, and interquartile range) for numeric variables such as HHIncomeMid, Poverty, AlcoholDay, AlcoholYear, and SleepHrsNight:

```{r}
summary_stats <- nhanes_clean %>%
  select(HHIncomeMid, Poverty, AlcoholDay, AlcoholYear, SleepHrsNight) %>%
  summary()
summary_stats
```
New variable groups:

```{r}
# IncomeGroup
nhanes_clean <- nhanes_clean %>%
  mutate(IncomeGroup = case_when(
    HHIncomeMid < 25000 ~ "Low",
    HHIncomeMid < 75000 ~ "Middle",
    TRUE ~ "High"
  ))

# AlcoholGroup
nhanes_clean <- nhanes_clean %>%
  mutate(AlcoholGroup = case_when(
    AlcoholDay == 0 ~ "None",
    AlcoholDay <= 2 ~ "Light",
    AlcoholDay <= 5 ~ "Moderate",
    TRUE ~ "Heavy"
  ))

# Convert new vars to factors
nhanes_clean <- nhanes_clean %>%
  mutate(IncomeGroup = factor(IncomeGroup, levels=c("Low","Middle","High")),
         AlcoholGroup = factor(AlcoholGroup, levels=c("None","Light","Moderate","Heavy")))

# Combine NA and No Smoke responses
nhanes_clean <- nhanes_clean %>%
  mutate(SmokeNow = ifelse(is.na(SmokeNow) | SmokeNow == "No", "No", "Yes"),
         SmokeNow = factor(SmokeNow, levels = c("No", "Yes")))
```

These statistics provide an overview of socioeconomic and lifestyle patterns in the sample. 

**Income (HHIncomeMid_log).** Most participants fall into the lower and middle income ranges, with only a small number earning at the very top end. This makes the original income data very right-skewed, but after applying a log transformation, the spread looks a lot better. The peaks in the histogram reflect how income was collected in grouped categories, yet overall the transformation makes it easier to see general income patterns without being pulled by a few extreme cases.

**Sleep vs. Health (SleepHrsNight by HealthGen).** People who report being in poor health tend to sleep noticeably less on average, while those who rate their health as good or excellent usually get a bit more rest. There’s also wider variation among people with poorer health, hinting that their sleep routines may be less regular. This pattern supports the idea that consistent, sufficient sleep is often tied to better overall well-being.

**Smoking (SmokeNow).** Among participants who answered, more people say they don’t currently smoke compared to those who do, which aligns with broader national declines in smoking. However, there’s also a large group of missing responses, likely individuals who skipped the question, given its sensitivity. Even so, the data show that most respondents are non-smokers, setting up useful comparisons for later lifestyle analyses.

**Alcohol (AlcoholDay).** Most people in the sample drink little to no alcohol on a typical day, while a much smaller group reports heavier consumption. This creates a long right tail in the distribution. This is typical of real-world drinking patterns, where heavy use is uncommon but impactful. These differences in habits will be worth exploring further when we look at how alcohol use connects to health and socioeconomic factors.

### Bivariate / Multivariate Analysis (relationships between key variables) 

To explore relationships between variables, we examined how socioeconomic status and lifestyle factors interact with one another and with health outcomes.

*Q1: How does socioeconomic status relate to smoking, alcohol, and drug use?*

1. Bar plot of smoking rates by education level

```{r}
ggplot(nhanes_clean, aes(x = Education, fill = SmokeNow)) +
  geom_bar(position = "fill") +  # proportion within each group
  scale_y_continuous(labels = scales::percent_format()) +  # show as %
  scale_fill_manual(values = c("No" = "bisque2", "Yes" = "lightsalmon3")) +  # custom colors
  labs(
    title = "Proportion of Smokers by Education Level",
    x = "Education Level",
    y = "Percentage",
    fill = "Currently Smokes"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
This bar plot shows that people who received 9-11th grade education are the most likely to be current smokers.

2. Violin plot of alcohol consumption by income group

```{r}
ggplot(nhanes_clean, aes(x = IncomeGroup, y = AlcoholDay)) +
  geom_violin(fill = "indianred", alpha = 0.5) +
  stat_summary(fun = median, geom = "point", size = 3, color = "indianred") +
  labs(title = "Daily Alcohol Consumption by Income Group",
       x = "Income Group", y = "Alcohol Drinks per Day") +
  theme_minimal()
```
This violin plot shows that more higher income people drink less alcohol, while lower income people drink more alcohol.

3. Stacked bar plot of hard drug use by home ownership

```{r}
df <- nhanes_clean %>%
  tidyr::drop_na(HomeOwn, HardDrugs)

ggplot(df, aes(x = HomeOwn, fill = HardDrugs)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = function(x) paste0(round(100 * x), "%")) +
labs(
title = "Hard Drug Use by Home Ownership",
x = "Home Ownership Status",
y = "Percentage of Respondents",
fill = "Hard Drugs"
)
```

<<<<<<< HEAD
Across all groups, most respondents reported not using hard drugs, but ownership status shows subtle differences. Renters and other living situations had slightly higher reported rates of drug use than homeowners. This pattern suggests that economic stability, reflected in home ownership, might be linked to lower likelihood of hard drug use.
```{r}
unique(nhanes_clean)
g <- ggplot(nhanes_clean, aes(x = SmokeNow, y = SleepHrsNight))
g + geom_violin(fill = "lightblue2", alpha = 0.7) + stat_summary(fun = median, geom = "point", size = 3, color = "lightblue4") + labs(x = "Smoking Status", y = "Average sleep duration", title = "Sleep Duration Based on Smoking Status") 
```

5. Box plot of self-rated health by alcohol consumption level

```{r}
answered <- c("Poor","Fair", "Good", "Excellent")

g <- ggplot(subset(nhanes_clean, HealthGen %in% answered) ,aes(x = HealthGen, y = AlcoholYear, fill = HealthGen))
g + geom_boxplot(alpha = 0.7) + coord_flip() + scale_fill_brewer(palette = "Spectral") +
  labs(title = "Distribution of self-related health by alcohol consumption level", x = "self-reported health", y = "Average Alcohol Use (drinks per year)") + theme(legend.position = "none")

```

<br>

*Q3: How do demographic factors influence lifestyle and health outcomes?*

<<<<<<< HEAD
6.  Faceted scatterplot of sleep duration vs. age by gender
=======
To explore relationships between variables, we examined how socioeconomic status and lifestyle factors interact with one another and with health outcomes.

### Socioeconomic Status vs. Lifestyle Behaviors

We analyzed how income, education, and home ownership relate to smoking and alcohol use. For instance, we plotted alcohol consumption by income group, faceted by smoking status:

```{r}
# violin plot: self-rated health by alcohol consumption level
library(viridis)
g <- ggplot(nhanes_clean, aes(x = HealthGen, y = AlcoholYear))
g + geom_boxplot() + ggthemes::theme_pander() +
  labs(title = "Distribution of self-related health by alcohol consumption level", x = "self-reported health", y = "Avg. Alcohol Use (years)") + scale_fill_viridis(discrete = T, alpha = 0.5)
```

### Demographic Influences

Finally, we used a faceted plot to look at how age, gender, and marital status interact with health and lifestyle outcomes.
>>>>>>> 51838e22b285bdd5bc51c3da5f4996a2d3937ee6

```{r}
# Faceted plot: Sleep by HealthGen across Age and Gender
ggplot(nhanes_clean, aes(x = Age, y = SleepHrsNight, color = Gender)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~MaritalStatus) +
  labs(title = "Sleep Duration by Age, Gender, and Marital Status", x = "Age", y = "Sleep Hours/Night")

```

## Insights

 
## Conclusion

