---
title: "DATA 350: Project 1 - Exploratory Data Analysis Report"
author: "Group 11: Ademir Ferreyra, Jay Nadkarni, Adrien Rozario"
date: "10/17/2025"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(NHANES)
library(forcats)
library(viridis)
library(corrplot)
library(shiny)
```

<br>

## Introduction

From 2009 to 2012, the U.S. National Center for Health (NCHS) conducted The National Health and Nutrition Examination Survey (NHANES) with the goal of assessing public health trends, lifestyles, and illness risk factors across the U.S. population. For our exploratory data analysis, we will use the NHANESraw dataset from the NHANES R package, which was collected from the unweighted original survey responses from 20,293 participants.

The purpose of this exploratory data analysis is to better understand how socioeconomic status, lifestyle choices, and demographic factors relate to overall health and well-being. Specifically, we aim to explore the following research questions:

* How does socioeconomic status (education, poverty, home ownership, income) relate to smoking, alcohol, and drug use?

* How do lifestyle choices (smoking, alcohol, and drug use) relate to self-rated health and sleep duration?

* How do demographic factors (age, marital status, gender) influence or interact with these lifestyle and health outcomes?

Key variables of interest include:

* HHIncomeMid – midpoint of household income category (numeric)

* Education – highest education level attained (categorical)

* HomeOwn – home ownership status (categorical)

* Poverty – family poverty income ratio (numeric)

* SmokeNow, Smoke100 – indicators of smoking behavior

* Alcohol12PlusYr, AlcoholDay, AlcoholYear – measures of alcohol use

* HardDrugs – indicator of recreational drug use (if available)

* HealthGen – self-rated general health (ordinal: Excellent–Poor)

* SleepHrsNight – average hours of sleep per night (numeric)

* Age, MaritalStatus, Gender – key demographic characteristics

We expect that higher socioeconomic status is associated with lower rates of smoking and drug use, moderate alcohol consumption, and better health outcomes.

<br>

## Data Cleaning

Before conducting our exploratory analysis, we performed several data cleaning steps to ensure the quality and consistency of the NHANESraw dataset. These steps included handling missing values, converting variable types, addressing outliers, and stating key assumptions.

### Missing Value Handling

We began by examining the dataset for missing values using the summary() and colSums(is.na()) functions. Some demographic and lifestyle variables contained missing entries, especially those related to sensitive topics such as income and alcohol use.
For essential demographic variables such as Gender, Age, and Education, we removed rows with missing values. For numeric variables like HHIncomeMid and SleepHrsNight, we used median imputation if the proportion of missing data was low. Variables with a high proportion of missing variables (over 50%) were excluded from the analysis.

```{r}
{
# Load data
data("NHANESraw")

# Preview
head(NHANESraw)

# Examine missing values
colSums(is.na(NHANESraw))

# Remove rows with missing important demographic variables
nhanes_clean <- NHANESraw %>%
  filter(!is.na(Gender), !is.na(Age), !is.na(Education))

# Median imputation for numeric variables with low amount of missing values
nhanes_clean <- nhanes_clean %>%
  mutate(
    HHIncomeMid = ifelse(is.na(HHIncomeMid), median(HHIncomeMid, na.rm=TRUE), HHIncomeMid),
    SleepHrsNight = ifelse(is.na(SleepHrsNight), median(SleepHrsNight, na.rm=TRUE), SleepHrsNight)
  )
}
```

### Type Conversions

We then standardized variable types to ensure accurate analysis. Categorical variables such as SmokeNow, Gender, Education, and HomeOwn were converted to factors. Ordinal variables like HealthGen were stored as ordered factors to preserve their natural ranking. Numeric variables such as HHIncomeMid, Poverty, and SleepHrsNight were converted to numeric types.

```{r}
# Convert variables to appropriate types
nhanes_clean <- nhanes_clean %>%
  mutate(
    SmokeNow = as.factor(SmokeNow),
    Smoke100 = as.factor(Smoke100),
    Gender = as.factor(Gender),
    Education = as.factor(Education),
    HomeOwn = as.factor(HomeOwn),
    HealthGen = factor(HealthGen, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"), ordered = TRUE),
    HHIncomeMid = as.numeric(HHIncomeMid),
    Poverty = as.numeric(Poverty),
    SleepHrsNight = as.numeric(SleepHrsNight)
  )
```

### Outlier Removal and Transformations

To prevent extreme values from distorting results, we visualized the distributions of key numeric variables using histograms and boxplots. Implausible outliers were removed, such as participants reporting more than 16 hours of sleep or more than 20 alcoholic drinks per day. For skewed numeric variables such as income, we applied a log transformation to normalize the distribution.

```{r}
# Remove extreme outliers
nhanes_clean <- nhanes_clean %>%
  filter(SleepHrsNight <= 16, AlcoholDay <= 20)

# Log-transform skewed variables
nhanes_clean <- nhanes_clean %>%
  mutate(HHIncomeMid_log = log(HHIncomeMid + 1))
```

### Assumptions

During data cleaning, we made the following assumptions:

* Missing values are not related to unobserved variables.

* Median imputation provides a reasonable estimate of central tendency without introducing bias.

* Outliers identified represent data entry errors or unrealistic responses rather than meaningful population extremes.

* Ordinal variables (such as self-rated health) are consistently interpreted across respondents.

* These cleaning steps prepared the dataset for accurate and meaningful exploratory data analysis.

<br>

## Univariate Analysis

We began by exploring the distribution of individual variables to understand their distribution and potential outliers.

### Summary statistics

We calculated key descriptive statistics (mean, median, standard deviation, and interquartile range) for numeric variables such as HHIncomeMid, Poverty, AlcoholDay, AlcoholYear, and SleepHrsNight:

```{r}
summary_stats <- nhanes_clean %>%
  select(HHIncomeMid, Poverty, AlcoholDay, AlcoholYear, SleepHrsNight) %>%
  summary()
summary_stats
```


```{r}

# Editing data

# IncomeGroup
nhanes_clean <- nhanes_clean %>%
  mutate(IncomeGroup = case_when(
    HHIncomeMid < 25000 ~ "Low",
    HHIncomeMid < 75000 ~ "Middle",
    TRUE ~ "High"
  ))

# AlcoholGroup
nhanes_clean <- nhanes_clean %>%
  mutate(AlcoholGroup = case_when(
    AlcoholDay == 0 ~ "None",
    AlcoholDay <= 2 ~ "Light",
    AlcoholDay <= 5 ~ "Moderate",
    TRUE ~ "Heavy"
  ))

# Convert new vars to factors
nhanes_clean <- nhanes_clean %>%
  mutate(IncomeGroup = factor(IncomeGroup, levels=c("Low","Middle","High")),
         AlcoholGroup = factor(AlcoholGroup, levels=c("None","Light","Moderate","Heavy")))

# Combine NA and No Smoke responses
nhanes_clean <- nhanes_clean %>%
  mutate(SmokeNow = ifelse(is.na(SmokeNow) | SmokeNow == "No", "No", "Yes"),
         SmokeNow = factor(SmokeNow, levels = c("No", "Yes")))

# Poverty groups
nhanes_clean <- nhanes_clean %>%
  mutate(PovertyGroup = ntile(Poverty, 3),
         PovertyGroup = factor(PovertyGroup, labels=c("Low","Medium","High")))

# Combine NA and No HardDrugs responses
nhanes_clean <- nhanes_clean %>%
  mutate(HardDrugs = case_when(
    HardDrugs %in% c("No", "Other") ~ "No",
    is.na(HardDrugs) ~ "No",
    TRUE ~ HardDrugs
  ))

# Remove NA marital status
nhanes_clean <- nhanes_clean %>%
  filter(!is.na(MaritalStatus))
```

These statistics provide an overview of socioeconomic and lifestyle patterns in the sample. 

## Multivariate Analysis 

To explore relationships between variables, we examined how socioeconomic status and lifestyle factors interact with one another and with health outcomes.

### Q1: How does socioeconomic status relate to smoking, alcohol, and drug use?

**1. Bar plot of smoking rates by education level**

```{r}
ggplot(nhanes_clean, aes(x = Education, fill = SmokeNow)) +
  geom_bar(position = "fill") +  # proportion within each group
  scale_y_continuous(labels = scales::percent_format()) +  # show as %
  scale_fill_manual(values = c("No" = "bisque2", "Yes" = "lightsalmon3")) +  # custom colors
  labs(
    title = "Proportion of Smokers by Education Level",
    x = "Education Level",
    y = "Proportion of Group",
    fill = "Currently Smokes"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br>

This bar plot shows that people who received 9-11th grade education are the most likely to be current smokers. This suggests that younger people are attracted to poor behaviors such as smoking. It is important to note that more than 50% of people do not smoke compared to those who do, at all education levels. 

<br>

**2. Violin plot of alcohol consumption by income group**

```{r}
ggplot(nhanes_clean %>% filter(AlcoholDay > 0), 
       aes(x = IncomeGroup, y = AlcoholDay)) +
  geom_violin(fill = "indianred", alpha = 0.5) +
  stat_summary(fun = median, geom = "point", size = 3, color = "indianred") +
  labs(title = "Daily Alcohol Consumption by Income Group",
       x = "Income Group", y = "Alcohol Drinks per Day") +
  theme_minimal()
```
<br>

Violin plots show both the distribution and density of the people in particular groups. In wider areas, more people fall within that range, and in narrower areas, less people fall within that range. In this plot, the low-income group has the narrowest shape, meaning fewer respondents overall, while the high-income group has the widest and most variable distribution.

Despite having more high-income respondents, their violin cuts off at higher numbers of drinks per day, showing that they drink less on average. In contrast, the low and middle-income groups extend higher on the alcohol scale, indicating more frequent drinking. This suggests that income may relate to alcohol use in ways influenced by lifestyle or stress rather than access alone.

<br>

**3. Stacked bar plot of hard drug use by poverty level**

```{r}
ggplot(
  nhanes_clean %>% dplyr::filter(!is.na(PovertyGroup), !is.na(HardDrugs)),
  aes(x = PovertyGroup, fill = HardDrugs)
) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("No" = "thistle", "Yes" = "plum4")) +
  labs(
    title = "Hard Drug Use by Poverty Level",
    x = "Poverty Group",
    y = "Proportion of Group",
    fill = "Uses Hard Drug"
  ) +
  theme_minimal()
```
<br>

We found that lower-income groups are more than 20%  likely to be consuming hard drugs based on the dataset, meaning that they are more likely to consume hard drugs such as stimulants and hallucinogens. This hints at a relationship between monetary and mental stability. The graph also reveals that most groups tend not to use hard drugs, with more than 75% of people answering that they do not consume hard drugs.

<br>

**4. Violin plot of sleep duration by smoking status**

```{r}
ui <- fluidPage(
  selectInput("graphs",
              choices = c("violin plot", "box plot"),
              label = "select which graph you want to see"),
  actionButton("select", "choose"),
  
  plotOutput("result"),
  
  textOutput("description")
)

server <- function(input, output, session){
  vals <- eventReactive(input$select, {
    if(input$graphs == "violin plot"){
      ggplot(nhanes_clean, aes(x = SmokeNow, y = SleepHrsNight)) + geom_violin(fill = "lightblue2", alpha = 0.7) + 
      stat_summary(fun = median, geom = "point", size = 3, color = "lightblue4") + labs(x = "Smoking Status", y = "Average Sleep Duration", title = "Sleep Duration Based on Smoking Status") 
    } else if (input$graphs == "box plot") {
      answered <- c("Poor","Fair", "Good", "Excellent")
      ggplot(subset(nhanes_clean, HealthGen %in% answered), aes(x = HealthGen, y = AlcoholYear, fill = HealthGen)) + geom_boxplot(alpha = 0.7) + 
      coord_flip() +  scale_fill_brewer(palette = "YlGnBu", direction = -1) +
      labs(title = "Distribution of self-related health by alcohol consumption", x = "Self-Eeported Health", y = "Number of Days of Drinking Alcohol in the Past Year") + 
      theme(legend.position = "none")
    }
  })
  
  output$result <- renderPlot({
    vals()
  })
  
  
  output$description <- eventReactive(input$select, {
    if (input$graphs == "violin plot"){
      "This violin plot compares hours of sleep for smokers vs. non-smokers. Both groups average around 7 hours, but the non-smokers’ more irregular, wiggly violin suggests greater variation in their sleep patterns. Smokers show a slightly tighter distribution, suggesting more regular sleep patterns. Since both violins are uneven, the data may be limited and interpretation of the results should not be considered completely accurate.
"
    } else if (input$graphs == "box plot"){
      "The boxplots reveal that people who consumed more alcohol per year report themselves to be in \"excellent\" condition; this is noted by the higher median. Whereas people who consume less alcohol per year tend to report themselves to be in \"poor\" or \"fair\" condition. We also noticed that there were outliers for all of the levels of self-reported health, with “good” health having the most outliers. Overall, we see a pattern of adults who report themselves as excellently healthy while drinking a significant amount of alcohol per year."
    }
      
      
  })
  
}

shinyApp(ui, server)
```

<br>

This violin plot compares hours of sleep for smokers vs. non-smokers. Both groups average around 7 hours, but the non-smokers’ more irregular, wiggly violin suggests greater variation in their sleep patterns. Smokers show a slightly tighter distribution, suggesting more regular sleep patterns. Since both violins are uneven, the data may be limited and interpretation of the results should not be considered completely accurate.

<br>

**5. Box plot of self-rated health by alcohol consumption**

```{r}
answered <- c("Poor","Fair", "Good", "Excellent")

g <- ggplot(subset(nhanes_clean, HealthGen %in% answered), aes(x = HealthGen, y = AlcoholYear, fill = HealthGen))
    g + geom_boxplot(alpha = 0.7) + coord_flip() +  scale_fill_brewer(palette = "YlGnBu", direction = -1) +
    labs(title = "Distribution of self-related health by alcohol consumption", x = "Self-Eeported Health", y = "Number of
    Days of Drinking Alcohol in the Past Year") + theme(legend.position = "none")
```

<br>

The boxplots reveal that people who consumed more alcohol per year report themselves to be in "excellent" condition; this is noted by the higher median. Whereas people who consume less alcohol per year tend to report themselves to be in "poor" or "fair" condition. We also noticed that there were outliers for all of the levels of self-reported health, with “good” health having the most outliers. Overall, we see a pattern of adults who report themselves as excellently healthy while drinking a significant amount of alcohol per year.

<br>

**6. Correlogram of Lifestyle Choices**

```{r}
df <- nhanes_clean %>%
  dplyr::mutate(
    SmokeNow = ifelse(SmokeNow == "Yes", 1, 0),
    HealthGen = as.numeric(factor(HealthGen, levels = c("Poor","Fair","Good","Very good","Excellent")))
  ) %>%
  dplyr::select(SleepHrsNight, AlcoholDay, SmokeNow, HealthGen) %>%
  na.omit()

# Increase margins BEFORE plotting
par(mar = c(3, 3, 6, 3))  # bottom, left, top, right margins

corrplot::corrplot(
  cor(df),
  method = "color",
  col = colorRampPalette(c("darkorange4", "white", "darkgreen"))(200),
  type = "upper",
  tl.col = "black", 
  tl.cex = 0.9,     
  tl.srt = 45          
)
```
<br>

The correlgram shows that nearly all variables have very weak relationships, indicated by the pale color shading. The only noticeably positive correlation appears between alcohol consumption and smoking status, suggesting that people who drink more per day are somewhat more likely to be current smokers. A smaller positive relationship is also visible between sleep hours and general health, meaning individuals who rate their health higher tend to sleep slightly more. All other correlations are extremely close to zero, signifying little to no linear association in this subset of variables.

<br>

### Q3: How do demographic factors influence lifestyle and health outcomes?

To further explore relationships between variables, we examined how socioeconomic status and lifestyle factors interact with one another and with health outcomes.

**7.  Heatmap of average daily alcohol use by age group and marital status**

```{r}
ggplot(
  nhanes_clean %>%
    dplyr::filter(!is.na(MaritalStatus), !is.na(Age)) %>%
    dplyr::mutate(
      AgeGroup = dplyr::case_when(
        Age < 30 ~ "0-30",
        Age < 45 ~ "30–44",
        Age < 60 ~ "45–59",
        TRUE     ~ "60+"
      )
    ) %>%
    dplyr::group_by(MaritalStatus, AgeGroup) %>%
    dplyr::summarise(AvgAlcoholDay = mean(AlcoholDay, na.rm = TRUE), .groups = "drop"),
  aes(x = MaritalStatus, y = AgeGroup, fill = AvgAlcoholDay)
) +
  geom_tile() +
  scale_fill_gradient(low = "pink", high = "violetred4") +
  labs(
    title = "Average Daily Alcohol Use by Age Group and Marital Status",
    x = "Marital Status", y = "Age Group", fill = "Average Drinks Per Day"
  ) +
  theme_minimal()
```

<br>

This heatmap shows a clear age-related pattern: younger adults tend to drink more alcohol per day than older adults, with the 60+ group consistently having the lowest averages. Across most age groups, individuals living with a partner report the highest alcohol intake, suggesting that relationship context may influence drinking behaviors. However, the overall differences are modest, and the heatmap mainly highlights general trends rather than strong contrasts.

<br>

**8. Faceted scatterplot (sleep duration by age, gender, and marital status)**

```{r}
ggplot(nhanes_clean, aes(x = Age, y = SleepHrsNight, color = Gender)) +
  geom_jitter(alpha = 0.5, width = 0.5, height = 0.2) +   # noise
  geom_smooth(method = "loess", se = TRUE) +              # smoothing line
  facet_wrap(~MaritalStatus) +
  labs(title = "Sleep Duration by Age, Gender, and Marital Status",
       x = "Age (years)", y = "Sleep Hours per Night") +
  theme_minimal()
```

<br>

This scatterplot shows that married and never-married adults have the most observations in the dataset, so their sleep ranges appear more densely populated. Adults who are widowed or separated have fewer data points, making their patterns less visible. Overall, sleep duration varies widely across all marital statuses, with no clear pattern indicating that being married or having a partner strongly affects sleep. Some slight decreases in sleep may be seen for older adults who are widowed or separated, but these groups are underrepresented, so conclusions should be made cautiously.

<br>

## Data Limitations

Throughout the project, we ran into some limitations: the dataset is oversampled, with about 20,293 observations in the raw dataset. This affects the way some graphs may be displayed. Another limitation to be noted is that the data were collected between 2009 and 2012. This could mean that the data may not be an accurate representation of people’s lifestyles in the present. If we were to analyze a dataset to answer the questions that we were curious about, we would make sure that the data we would analyze is up to date or more recent. That way, we would get a more accurate representation of the population today. We did end up finding relationships between socioeconomic status and alcohol abuse, finding that lower-class people tended to consume alcohol and drugs more than the middle and upper classes. In addition to that, we found that people who consumed more alcohol tended to rate themselves as being in great health conditions compared to those who didn’t. Finally, we also found relationships between sleep schedules and demographics, finding that there may be a correlation between missing a partner that once existed and missing sleep in old age. 

## Conclusion 

Our exploratory data analysis examined how socioeconomic status, lifestyle behaviors, and demographic factors relate to health outcomes such as self-rated health and sleep duration. We observed that lower-income and lower-education individuals were more likely to engage in smoking and hard drug use, while alcohol consumption varied in ways not strictly predicted by income, suggesting the influence of social and lifestyle factors.

We found that sleep duration and self-rated health showed weak but notable relationships with lifestyle behaviors, and demographic factors such as age and marital status contributed additional variability, particularly for older adults and underrepresented marital status groups. Visualizations such as violin plots, heatmaps, and correlograms helped reveal these patterns, although uneven sample sizes and data sparsity for certain groups limit the generalizability of these findings.

Overall, our results highlight the complex connections between social, behavioral, and demographic determinants of health. While higher socioeconomic status tends to align with healthier behaviors, individual lifestyle choices and demographic contexts introduce meaningful variation. Future analyses with more recent, representative, and comprehensive datasets, combined with statistical modeling, could better portray the relationships between these variables.

<br>
