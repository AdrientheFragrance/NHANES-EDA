---
title: "DATA 350: Project 1 - Exploratory Data Analysis Report"
author: "Group 11: Ademir Ferreyra, Jay Nadkarni, Adrien Rozario"
date: "10/17/2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(NHANES)
library(forcats)
library(viridis)
library(corrplot)
```

<br>

## Introduction

From 2009 to 2012, the U.S. National Center for Health (NCHS) conducted The National Health and Nutrition Examination Survey (NHANES) with the goal of assessing public health trends, lifestyles, and illness risk factors across the U.S. population. For our exploratory data analysis, we will use the NHANESraw dataset from the NHANES R package, which was collected from the unweighted original survey responses from 20,293 participants.

The purpose of this exploratory data analysis is to better understand how socioeconomic status, lifestyle choices, and demographic factors relate to overall health and well-being. Specifically, we aim to explore the following research questions:

* How does socioeconomic status (education, poverty, home ownership, income) relate to smoking, alcohol, and drug use?

* How do lifestyle choices (smoking, alcohol, and drug use) relate to self-rated health and sleep duration?

* How do demographic factors (age, marital status, gender) influence or interact with these lifestyle and health outcomes?

Key variables of interest include:

* HHIncomeMid – midpoint of household income category (numeric)

* Education – highest education level attained (categorical)

* HomeOwn – home ownership status (categorical)

* Poverty – family poverty income ratio (numeric)

* SmokeNow, Smoke100 – indicators of smoking behavior

* Alcohol12PlusYr, AlcoholDay, AlcoholYear – measures of alcohol use

* HardDrugs – indicator of recreational drug use (if available)

* HealthGen – self-rated general health (ordinal: Excellent–Poor)

* SleepHrsNight – average hours of sleep per night (numeric)

* Age, MaritalStatus, Gender – key demographic characteristics

We expect that higher socioeconomic status is associated with lower rates of smoking and drug use, moderate alcohol consumption, and better health outcomes.

<br>

## Data Cleaning

Before conducting our exploratory analysis, we performed several data cleaning steps to ensure the quality and consistency of the NHANESraw dataset. These steps included handling missing values, converting variable types, addressing outliers, and stating key assumptions.

### Missing Value Handling

We began by examining the dataset for missing values using the summary() and colSums(is.na()) functions. Some demographic and lifestyle variables contained missing entries, especially those related to sensitive topics such as income and alcohol use.
For essential demographic variables such as Gender, Age, and Education, we removed rows with missing values. For numeric variables like HHIncomeMid and SleepHrsNight, we used median imputation if the proportion of missing data was low. Variables with a high proportion of missing variables (over 50%) were excluded from the analysis.

```{r}
{
# Load data
data("NHANESraw")

# Preview
head(NHANESraw)

# Examine missing values
colSums(is.na(NHANESraw))

# Remove rows with missing important demographic variables
nhanes_clean <- NHANESraw %>%
  filter(!is.na(Gender), !is.na(Age), !is.na(Education))

# Median imputation for numeric variables with low amount of missing values
nhanes_clean <- nhanes_clean %>%
  mutate(
    HHIncomeMid = ifelse(is.na(HHIncomeMid), median(HHIncomeMid, na.rm=TRUE), HHIncomeMid),
    SleepHrsNight = ifelse(is.na(SleepHrsNight), median(SleepHrsNight, na.rm=TRUE), SleepHrsNight)
  )
}
```

### Type Conversions

We then standardized variable types to ensure accurate analysis. Categorical variables such as SmokeNow, Gender, Education, and HomeOwn were converted to factors. Ordinal variables like HealthGen were stored as ordered factors to preserve their natural ranking. Numeric variables such as HHIncomeMid, Poverty, and SleepHrsNight were converted to numeric types.

```{r}
# Convert variables to appropriate types
nhanes_clean <- nhanes_clean %>%
  mutate(
    SmokeNow = as.factor(SmokeNow),
    Smoke100 = as.factor(Smoke100),
    Gender = as.factor(Gender),
    Education = as.factor(Education),
    HomeOwn = as.factor(HomeOwn),
    HealthGen = factor(HealthGen, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"), ordered = TRUE),
    HHIncomeMid = as.numeric(HHIncomeMid),
    Poverty = as.numeric(Poverty),
    SleepHrsNight = as.numeric(SleepHrsNight)
  )
```

### Outlier Removal and Transformations

To prevent extreme values from distorting results, we visualized the distributions of key numeric variables using histograms and boxplots. Implausible outliers were removed, such as participants reporting more than 16 hours of sleep or more than 20 alcoholic drinks per day. For skewed numeric variables such as income, we applied a log transformation to normalize the distribution.

```{r}
# Remove extreme outliers
nhanes_clean <- nhanes_clean %>%
  filter(SleepHrsNight <= 16, AlcoholDay <= 20)

# Log-transform skewed variables
nhanes_clean <- nhanes_clean %>%
  mutate(HHIncomeMid_log = log(HHIncomeMid + 1))
```

### Assumptions

During data cleaning, we made the following assumptions:

* Missing values are not related to unobserved variables.

* Median imputation provides a reasonable estimate of central tendency without introducing bias.

* Outliers identified represent data entry errors or unrealistic responses rather than meaningful population extremes.

* Ordinal variables (such as self-rated health) are consistently interpreted across respondents.

* These cleaning steps prepared the dataset for accurate and meaningful exploratory data analysis.

<br>

## Univariate Analysis

We began by exploring the distribution of individual variables to understand their distribution and potential outliers.

### Summary statistics

We calculated key descriptive statistics (mean, median, standard deviation, and interquartile range) for numeric variables such as HHIncomeMid, Poverty, AlcoholDay, AlcoholYear, and SleepHrsNight:

```{r}
summary_stats <- nhanes_clean %>%
  select(HHIncomeMid, Poverty, AlcoholDay, AlcoholYear, SleepHrsNight) %>%
  summary()
summary_stats
```


```{r}

# Editing data

# IncomeGroup
nhanes_clean <- nhanes_clean %>%
  mutate(IncomeGroup = case_when(
    HHIncomeMid < 25000 ~ "Low",
    HHIncomeMid < 75000 ~ "Middle",
    TRUE ~ "High"
  ))

# AlcoholGroup
nhanes_clean <- nhanes_clean %>%
  mutate(AlcoholGroup = case_when(
    AlcoholDay == 0 ~ "None",
    AlcoholDay <= 2 ~ "Light",
    AlcoholDay <= 5 ~ "Moderate",
    TRUE ~ "Heavy"
  ))

# Convert new vars to factors
nhanes_clean <- nhanes_clean %>%
  mutate(IncomeGroup = factor(IncomeGroup, levels=c("Low","Middle","High")),
         AlcoholGroup = factor(AlcoholGroup, levels=c("None","Light","Moderate","Heavy")))

# Combine NA and No Smoke responses
nhanes_clean <- nhanes_clean %>%
  mutate(SmokeNow = ifelse(is.na(SmokeNow) | SmokeNow == "No", "No", "Yes"),
         SmokeNow = factor(SmokeNow, levels = c("No", "Yes")))

# Poverty groups
nhanes_clean <- nhanes_clean %>%
  mutate(PovertyGroup = ntile(Poverty, 3),
         PovertyGroup = factor(PovertyGroup, labels=c("Low","Medium","High")))

# Combine NA and No HardDrugs responses
nhanes_clean <- nhanes_clean %>%
  mutate(HardDrugs = case_when(
    HardDrugs %in% c("No", "Other") ~ "No",
    is.na(HardDrugs) ~ "No",
    TRUE ~ HardDrugs
  ))

# Remove NA marital status
nhanes_clean <- nhanes_clean %>%
  filter(!is.na(MaritalStatus))
```

These statistics provide an overview of socioeconomic and lifestyle patterns in the sample. 

## Multivariate Analysis 

To explore relationships between variables, we examined how socioeconomic status and lifestyle factors interact with one another and with health outcomes.

### Q1: How does socioeconomic status relate to smoking, alcohol, and drug use?

**1. Bar plot of smoking rates by education level**

```{r}
ggplot(nhanes_clean, aes(x = Education, fill = SmokeNow)) +
  geom_bar(position = "fill") +  # proportion within each group
  scale_y_continuous(labels = scales::percent_format()) +  # show as %
  scale_fill_manual(values = c("No" = "bisque2", "Yes" = "lightsalmon3")) +  # custom colors
  labs(
    title = "Proportion of Smokers by Education Level",
    x = "Education Level",
    y = "Proportion of Group",
    fill = "Currently Smokes"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br>

This bar plot shows that people who received 9-11th grade education are the most likely to be current smokers. This suggests that younger people are attracted to poor behaviors such as smoking. It is important to note that more than 50% of people do not smoke compared to those who do, at all education levels. 

<br>

**2. Violin plot of alcohol consumption by income group**

```{r}
ggplot(nhanes_clean, aes(x = IncomeGroup, y = AlcoholDay)) +
  geom_violin(fill = "indianred", alpha = 0.5) +
  stat_summary(fun = median, geom = "point", size = 3, color = "indianred") +
  labs(title = "Daily Alcohol Consumption by Income Group",
       x = "Income Group", y = "Alcohol Drinks per Day") +
  theme_minimal()
```
<br>

We found that people with higher income consumed less alcohol, whereas lower-income people drank more. This is interesting because of the assumption that people who earn more money have easier access to alcoholic beverages. It comes to show that there could be other factors that explain why lower-income people are consuming more alcohol, such as lifestyle and mental health. We can also see that there were more high-income people who participated in the survey compared to lower-income students.

<br>

**3. Stacked bar plot of hard drug use by poverty level**

```{r}
ggplot(
  nhanes_clean %>% dplyr::filter(!is.na(PovertyGroup), !is.na(HardDrugs)),
  aes(x = PovertyGroup, fill = HardDrugs)
) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("No" = "thistle", "Yes" = "plum4")) +
  labs(
    title = "Hard Drug Use by Poverty Level",
    x = "Poverty Group",
    y = "Proportion of Group",
    fill = "Uses Hard Drug"
  ) +
  theme_minimal()
```
<br>

We found that lower-income groups are more than 20%  likely to be consuming hard drugs based on the dataset, meaning that they are more likely to consume hard drugs such as stimulants and hallucinogens. This hints at a relationship between monetary and mental stability. The graph also reveals that most groups tend not to use hard drugs, with more than 75% of people answering that they do not consume hard drugs.

<br>

**4. Violin plot of sleep duration by smoking status**

```{r}
g <- ggplot(nhanes_clean, aes(x = SmokeNow, y = SleepHrsNight))
g + geom_violin(fill = "lightblue2", alpha = 0.7) + stat_summary(fun = median, geom = "point", size = 3, color = "lightblue4") + labs(x = "Smoking Status", y = "Average Sleep Duration", title = "Sleep Duration Based on Smoking Status") 
```

<br>

This violin plot shows that both smokers and non-smokers average around 7 hours of sleep per night. But, the non-smokers' plot has a wider shape, indicating that they are more likely to sleep the average healthy amount of hours than smokers. It is important to note that the the shapes of both violin plots are wiggly, and thus they are not perfectly reliable.

<br>

**5. Box plot of self-rated health by alcohol consumption**

```{r}
answered <- c("Poor","Fair", "Good", "Excellent")

g <- ggplot(subset(nhanes_clean, HealthGen %in% answered), aes(x = HealthGen, y = AlcoholYear, fill = HealthGen))
    g + geom_boxplot(alpha = 0.7) + coord_flip() +  scale_fill_brewer(palette = "Reds", direction = -1) +
    labs(title = "Distribution of self-related health by alcohol consumption", x = "Self-Eeported Health", y = "Number of
    Days of Drinking Alcohol in the Past Year") + theme(legend.position = "none")
```

<br>

The boxplots reveal that people who consumed more alcohol per year report themselves to be in "excellent" condition; this is noted by the median. Whereas people who consume fewer alcohol per year tend to report themselves to be in "poor" or "fair" condition. We also noticed that there were outliers for all of the levels of self-reported health, with “good” health having the most outliers. Overall, we see a pattern of adults who report themselves as excellently healthy while drinking a significant amount of alcohol per year.

<br>

**6. Correlogram**

```{r}
df <- nhanes_clean %>%
  dplyr::mutate(
    SmokeNow = ifelse(SmokeNow == "Yes", 1, 0),
    HealthGen = as.numeric(factor(HealthGen, levels = c("Poor","Fair","Good","Very good","Excellent")))
  ) %>%
  dplyr::select(SleepHrsNight, AlcoholDay, SmokeNow, HealthGen) %>%
  na.omit()

corrplot::corrplot(cor(df), method = "color", col = colorRampPalette(c("white","black"))(200), type = "upper")
```
<br>

We have noticed that there is a correlation of 0.2 between alcohol consumption and smoking. This could indicate that people who consume drinks of alcohol during the day are more likely to be current smokers. In contrast, there is a -0.4 correlation between the persons’ average sleeping hours and their smoking habits. This can reinforce the findings of our violin plot, which mentions that people who smoke average the same amount of sleeping hours as non-smokers. However, it is important to remain skeptical about this claim due to those findings being unreliable.

<br>

### Q3: How do demographic factors influence lifestyle and health outcomes?

To explore relationships between variables, we examined how socioeconomic status and lifestyle factors interact with one another and with health outcomes.

**7.  Heatmap of average daily alcohol use by age group and marital status**

```{r}
ggplot(
  nhanes_clean %>%
    dplyr::filter(!is.na(MaritalStatus), !is.na(Age)) %>%
    dplyr::mutate(
      AgeGroup = dplyr::case_when(
        Age < 30 ~ "0-30",
        Age < 45 ~ "30–44",
        Age < 60 ~ "45–59",
        TRUE     ~ "60+"
      )
    ) %>%
    dplyr::group_by(MaritalStatus, AgeGroup) %>%
    dplyr::summarise(AvgAlcoholDay = mean(AlcoholDay, na.rm = TRUE), .groups = "drop"),
  aes(x = MaritalStatus, y = AgeGroup, fill = AvgAlcoholDay)
) +
  geom_tile() +
  scale_fill_gradient(low = "indianred", high = "black") +  # 0 → red, high → black
  labs(
    title = "Average Daily Alcohol Use by Age Group and Marital Status",
    x = "Marital Status", y = "Age Group", fill = "Average Drinks Per Day"
  ) +
  theme_minimal()
```

<br>

This heatmap shows that adults aged 60 and older tend to consume the least amount of alcohol on a daily basis, while younger adults, especially those living with a partner, drink the most. Overall, alcohol consumption decreases with age, but relationship status does play a role as well.

<br>

**8. Faceted scatterplot (sleep duration by age, gender, and marital status)**

```{r}
ggplot(nhanes_clean, aes(x = Age, y = SleepHrsNight, color = Gender)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~MaritalStatus) 
  labs(title = "Sleep Duration by Age, Gender, and Marital Status", x = "Age", y = "Sleep Hours/Night")
```

<br>

This scatterplot highlights how married adults have the most diverse range of sleep hours, emphasizing that sleep is not related to marriage and varies per individual. Adults living with their partner and adults who have never married also have a diverse range of sleep hours, indicating that sleep is not related to the presence of a partner in life. Divorced and widowed adults recorded having less sleep as they aged, suggesting a correlation between missing a partner that once existed and missing sleep in old age.

<br>

## Data Limitations

Throughout the project, we ran into some limitations: the dataset is oversampled, with about 20,293 observations in the raw dataset. This affects the way some graphs may be displayed. Another limitation to be noted is that the data were collected between 2009 and 2012. This could mean that the data may not be an accurate representation of people’s lifestyles in the present. If we were to analyze a dataset to answer the questions that we were curious about, we would make sure that the data we would analyze is up to date or more recent. That way, we would get a more accurate representation of the population today. We did end up finding relationships between socioeconomic status and alcohol abuse, finding that lower-class people tended to consume alcohol and drugs more than the middle and upper classes. In addition to that, we found that people who consumed more alcohol tended to rate themselves as being in great health conditions compared to those who didn’t. Finally, we also found relationships between sleep schedules and demographics, finding that there may be a correlation between missing a partner that once existed and missing sleep in old age. 

## Conclusion 

Our analysis aimed to assess how socioeconomic status such as education, poverty, and income relate to lifestyle choices such as smoking, alcohol, and drug use. We also aimed to explore how those lifestyle choices related to health outcomes such as self-rated health level and sleep duration. Additionally, we sought out how demographic factors such as age, marital status, and gender, influences these lifestyle choices and health outcomes. 

Once we cleaned the data generated visualizations, we observed clear links between socioeconomic status, lifestyle behaviors, and health outcomes. Individuals with lower income and education levels were more likely to engage in smoking and drug use, while alcohol consumption patterns appeared influenced by additional social factors. Lifestyle behaviors such as smoking and alcohol use showed a slight relationship to self-rated health and sleep duration, though not always in the expected direction. Demographic factors, including age and marital status, also shaped these relationships, particularly in alcohol use and sleep trends.

Overall, our findings highlight the interplay between social and behavioral determinants of health. While socioeconomic advantages are generally associated with healthier habits, individual lifestyle choices and demographic contexts contribute meaningful variation. It is important to recognize the data limitations that hinder the accuracy of our findings. Further statistical modeling, preferably with less limitations, could help accurately clarify the causal pathways behind these associations.

<br>
